<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">Attention | 宵晓咲</title>
  
    <link rel="shortcut icon" href="/images/img/apple-touch-icon-next.png">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "宵晓咲";
  mashiro_option.author_name = "宵晓咲";
  mashiro_option.site_url = "https://aisaka.cloud";
  mashiro_option.v_appId = "d2ULHdiL7VOfJf17rpCD4DOX-gzGzoHsz";
  mashiro_option.v_appKey = "OLf7QaP1oTtqKhulLHuajYKu";
  mashiro_option.mathjax = "1";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "/images/bg/1.jpg".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop ">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <div id="preloader"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <!-- <a href="https://aisaka.cloud"> -->
          <img src="/images/img/112.jpg">
        <!-- </a> -->
      </div>
      <div class="header-info">
        <p>且听风吟</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="mailto:htt20081@126.com" target="_blank" class="social-github" title="email">
                    <img src="/images/icon/email.svg">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://music.163.com/#/user/home?id=28578795" target="_blank" class="social-github" title="wangyiyun">
                    <img src="/images/icon/wangyiyun.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://space.bilibili.com/741763" target="_blank" class="social-github" title="bilibili">
                    <img src="/images/icon/bilibili.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://steamcommunity.com/id/aisakaki/" target="_blank" class="social-github" title="steam">
                    <img src="/images/icon/steam.svg">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://bangumi.tv/user/aisakaki" target="_blank" class="social-github" title="bangumi">
                    <img src="/images/icon/bgm.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://my.playstation.com/profile/AISAKAKI" target="_blank" class="social-github" title="psn">
                    <img src="/images/icon/ps.png">
                  </a>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <!-- <div id="video-btn" class="loadvideo videolive">
    </div> -->
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>

    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono"></span>
            <span class="shironeko">宵晓咲</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  " aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    时间线
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    ACG
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/Anime/">
                          <i class="fa " aria-hidden="true"></i>
                          动画
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/Game/">
                          <i class="fa " aria-hidden="true"></i>
                          游戏
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/Music/">
                          <i class="fa " aria-hidden="true"></i>
                          音乐
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1/">
                          <i class="fa " aria-hidden="true"></i>
                          游戏设计
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-book faa-shake" aria-hidden="true"></i>
                    随想
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/%E6%97%A5%E8%AE%B0/">
                          <i class="fa " aria-hidden="true"></i>
                          日记
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E9%98%85%E8%AF%BB/">
                          <i class="fa " aria-hidden="true"></i>
                          阅读
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E9%9A%8F%E7%AC%94/">
                          <i class="fa " aria-hidden="true"></i>
                          随笔
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-code faa-shake" aria-hidden="true"></i>
                    技术
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/%E7%A8%8B%E5%BA%8F%E8%AF%AD%E8%A8%80/">
                          <i class="fa " aria-hidden="true"></i>
                          程序
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                          <i class="fa " aria-hidden="true"></i>
                          人工智能
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E5%BC%80%E5%8F%91/">
                          <i class="fa " aria-hidden="true"></i>
                          开发
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E4%B8%AD%E9%97%B4%E4%BB%B6/">
                          <i class="fa " aria-hidden="true"></i>
                          中间件
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E4%BA%91/">
                          <i class="fa " aria-hidden="true"></i>
                          网络
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E5%AD%98%E5%82%A8/">
                          <i class="fa " aria-hidden="true"></i>
                          存储
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
                          <i class="fa " aria-hidden="true"></i>
                          算法
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/">
                          <i class="fa " aria-hidden="true"></i>
                          CS
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">
                          <i class="fa " aria-hidden="true"></i>
                          论文
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    其它
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/%E7%A1%AC%E4%BB%B6/">
                          <i class="fa " aria-hidden="true"></i>
                          硬件
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E5%8D%9A%E5%AE%A2/">
                          <i class="fa " aria-hidden="true"></i>
                          博客
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E5%B7%A5%E5%85%B7/">
                          <i class="fa " aria-hidden="true"></i>
                          工具
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/%E6%82%A6%E8%AF%BB/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          书单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          番组
                        </a>
                      </li>
                    
                      <li>
                        <a href="/musicLibrary/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags/%E5%9B%BE%E9%9B%86/">
                          <i class="fa fa-photo" aria-hidden="true"></i>
                          图集
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    Link
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/about/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-meetup faa-shake" aria-hidden="true"></i>
                    我
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
          <header class="entry-header">
            <h1 class="entry-title">Attention</h1>
            <p class="entry-census">&nbsp;&nbsp;2020-5-29&nbsp;</p>

            <hr>
          </header>
        
        <div class="entry-content">
          <center>以前的，整理到网站上</center>

<a id="more"></a>    
<h2 id="Attention机制"><a href="#Attention机制" class="headerlink" title="Attention机制"></a>Attention机制</h2><p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/0.jpg" alt="img"></p>
<p><strong>如上图</strong>，将Source中的构成元素（输入序列）想象成是由一系列的$<Key,Value>$数据对构成，此时给定Target中的某个元素$Query$，<strong>①通过计算$Query$和<u>每个</u>$Key$的相似性（相关性），得到<u>每个</u>$Key$对应<u>$Value$的权重系数</u>，②然后将得到的各个权重系数与对应的各个$Value$相乘进行加权求和，即得到了最终的$Attention$数值</strong>。所以<strong>本质上Attention机制是对Source中元素的$Value$值进行加权求和</strong>，即可以将其本质思想改写为如下公式：</Key,Value></p>
<script type="math/tex; mode=display">
Attention(Query,Source)=\sum_{i=1}^{||Source||}Similaity(Query,Key_i)*Value_i</script><p>$Similaity(Query,Key_i)$也叫Attention Score。在词嵌入空间，两个向量的<strong>相似度可以由内积求得</strong>，也就是说<strong>$query·key$再经过softmax归一化后即为attention权重</strong>。</p>
<p><strong>理解思想：</strong>以上步骤可以理解为从大量信息中有选择地筛选出少量重要信息并聚焦到这些重要信息上，忽略大多不重要的信息。聚焦的过程体现在权重系数的计算上（$softmax(query·key)$），权重越大越聚焦于其对应的$value$值上，即权重代表了信息的重要性，而$value$是其对应的信息。</p>
<p>也可以理解为是一种<strong>软寻址</strong>过程（这种寻址会从各个地址根据一定权重取出数据）：$key$是数据地址，$value$是对应地址储存的数据内容，$query$是待查地址，任务目标是查询$key=query$地址所储存的数据。于是先用$query$与每个$key$求相似度，得到每个地址的重要性，然后再对每个地址的$value$进行加权求和，得到最终的$value$值</p>
<p>P.S.1<strong>在基于Attention的Seq2Seq任务中，$Key=Value$，即输入的都是句子中每个单词对应的语义编码</strong>，具体实践反应在$Key$和$Value$是共享同一个线性层（参数矩阵）</p>
<p>P.S.2 Attention Score即$query与key$的相似度，其计算方式有多种，最常用的点积：即$q·k$，还有其它方式，略</p>
<p>P.S.3 <strong>求得各输入的$key$与$value$的相似度（Attention Score）之后还要经过一层softmax</strong>，做归一化，转化为概率才是<strong>注意力权重</strong></p>
<h2 id="应用Attention于Seq2Seq结构"><a href="#应用Attention于Seq2Seq结构" class="headerlink" title="应用Attention于Seq2Seq结构"></a>应用Attention于Seq2Seq结构</h2><p><strong>无attention的Seq2Seq模型：</strong></p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/1.jpg" alt="img"></p>
<script type="math/tex; mode=display">
\mathbb y_1=f(C)</script><script type="math/tex; mode=display">
\mathbb y_2=f(C,\mathbb y_1)</script><script type="math/tex; mode=display">
\mathbb y_3=f(C,\mathbb y_1,\mathbb y_2)</script><p><strong>→→→有attention的Seq2Seq模型（$Source≠Target$，non-intra attention）←←←：</strong></p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/3.jpg" alt="img"></p>
<script type="math/tex; mode=display">
\mathbb y_1=f(C_1)</script><script type="math/tex; mode=display">
\mathbb y_2=f(C_2,\mathbb y_1)</script><script type="math/tex; mode=display">
\mathbb y_3=f(C_3,\mathbb y_1,\mathbb y_2)</script><p>在有attention的seq2seq模型中，$C$变成了不同的$C_1,C_2,C_3$就是说：<strong>不同输出时刻（输出序列的不同单词）的注意力（对Encoder所编码的语义分配的概率信息）不同</strong>。换句话说<strong>在生成每个单词$\mathbb y_i$的时候，原先都是相同固定的中间语义表示$C$会被替换成根据当前生成单词而不断变化的$C_i$。</strong>理解Attention模型的关键就是这里。</p>
<p><strong>如何理解Attention？</strong>一般在NLP里会把Attention模型看作是<strong>[输出Target句子中<u>某个</u>单词]和[输入Source句子<u>每个</u>单词]的对齐（对应概率关系）模型</strong></p>
<p><strong>对于采用RNN的Decoder来说，$query$是Decoder RNN目前时刻的hidden state $h_t$，$Key$和$ Value$是Encoder RNN各个时刻的hidden state $H_1,H_2,H_3,H_4$。</strong> （这个例子使用soft-attention+2RNN seq2seq结构）</p>
<p>（接上段话）于是就有：在时刻$i$，如果要生成$y_i$单词，我们是可以知道Target在生成$Y_i$之前的时刻$i-1$时，隐层节点$i-1$时刻的输出值$H_{i-1}$的，而我们的目的是要计算生成$Y_i$时输入句子中的单词$x_1,x_2,x_3$对$Y_i$来说的注意力分配概率分布，那么可以<strong>用Target输出句子$i-1$时刻的隐层节点状态$H_{i-1}$去一一和输入句子Source中每个单词对应的RNN隐层节点状态$h_j$进行对比，即通过函数$F(h_j,H_i-1)$来获得目标单词$y_i$和每个输入单词对应的对齐可能性</strong>，这个$F$函数在不同论文里可能会采取不同的方法。</p>
<h2 id="Non-Intra-Attention"><a href="#Non-Intra-Attention" class="headerlink" title="Non-Intra Attention"></a>Non-Intra Attention</h2><p>①<strong>源与目标不同</strong>，$Source≠Target$</p>
<p>②<strong>$query$来源于输出Decoder部分，$key$来源于输入Encoder部分</strong>。如上面例子里用的soft-attention+2RNN seq2seq结构，非self-attention都是decoder里输出的每个Target：$y$作为$query$，encoder的语义编码（隐藏层输出）作为$key$，然后这两做内积求attention</p>
<p>下面三种attention都以Encoder为RNN举例</p>
<h3 id="Soft-attention"><a href="#Soft-attention" class="headerlink" title="Soft attention"></a>Soft attention</h3><p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/4.png" alt="这里写图片描述"></p>
<p>该图中橘黄色方块就是Decoder部分的当前输出$s_t$，$\alpha_i$就是注意力权重，$query=s_t$，$Key=h_1,h_2,\cdots,h_N$，最基本的attention机制，原理很容易理解</p>
<p>上面举的soft-attention+2RNN seq2seq结构例子用的就是用的soft attention</p>
<p><strong>这个“软”指的是每个输入的向量（单词）都会分配一个注意力权重</strong></p>
<p>实践例子：<a target="_blank" rel="noopener" href="https://pytorch.org/tutorials/intermediate/seq2seq_translation_tutorial.html">官网DEMO</a>    这个例子用GRU Decoder + soft-attention做seq2seq机器翻译</p>
<h3 id="Hard-attention"><a href="#Hard-attention" class="headerlink" title="Hard attention"></a>Hard attention</h3><p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/5.png" alt="这里写图片描述"></p>
<p>权重很硬，只在输入句子中找到特定单词，其注意力权重才为1，其它单词的注意力权重都是0</p>
<p>这个“硬”指的就是只有某特定向量权重为1，其它权重全为0，只注意那一个向量；用在图像领域</p>
<h3 id="local-attention-（半软半硬attention）"><a href="#local-attention-（半软半硬attention）" class="headerlink" title="local attention （半软半硬attention）"></a>local attention （半软半硬attention）</h3><p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/6.png" alt="这里写图片描述"></p>
<p>只考虑部分窗口内的encoder隐藏输出，其余部分为0，在窗口内和soft attention（global attention）一样</p>
<p>半软：窗口内的是soft attention</p>
<p>半硬：对于指定窗口外的所有输入全部设置注意力权重为0</p>
<p>相比soft(global) attention可以减少计算量</p>
<h2 id="Intra-Attention：Self-Attention"><a href="#Intra-Attention：Self-Attention" class="headerlink" title="Intra Attention：Self-Attention"></a>Intra Attention：Self-Attention</h2><p>intra attention与上面几种attention都不同，是<strong>一种特殊的attention</strong>：</p>
<p>①【<strong>源与目标相同</strong>，$Source=Target$】，也就是说一个<strong>Self-Attention结构本身就是一个Source输入与Target输出相同的Seq2Seq</strong>，如下图</p>
<p>也就是说【<strong>self-attention的$query$和$key$都来源于输入句子</strong>】，是一种<strong>原文自己内部的注意力机制</strong></p>
<p>②其$Q,K,V$不通过RNN等神经网络产生，而是训练三个嵌入层参数矩阵</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/7.png" alt="这里写图片描述"></p>
<p>这种结构可以完全替代Seq2Seq中Encoder和Decoder中的RNN，变成后面的Seq2Seq with self-attention结构</p>
<p>也是Transformer结构的基础</p>
<h3 id="与RNN和CNN相比"><a href="#与RNN和CNN相比" class="headerlink" title="与RNN和CNN相比"></a>与RNN和CNN相比</h3><ol>
<li><p>Seq2Seq模型中运用RNN或CNN的问题：</p>
<p>RNN难以平行化；CNN虽可以平行化，但是dependent范围比较短，必须通过叠多层来扩大视野域</p>
<p>RNN有长距离依赖问题，当前时间必然受最相邻时间步输入的影响，而以前时间步需要经过若干时间步步骤的信息累积，距离越远，有效捕捉得到的历史信息越少，甚至可能出现梯度消失；</p>
</li>
<li><p>于是提出Self-Attention来<strong>完全代替</strong>RNN：</p>
<p><strong>一切RNN能做的，都可以用self-attention替代</strong></p>
<p>（<strong>也同理</strong>，使用预训练word2vec之后，Transformer模型之前也可以nn.embedding嵌入层生成词向量，一起训练嵌入层参数以<strong>特化</strong>词向量）</p>
</li>
<li><p>self-attention的好处：</p>
<p><strong>并行、可以很好捕捉长距离依赖问题</strong>（用注意力解决）,它也 摒弃了 CNN 的局部假设，想要寻找长距离的关联依赖。</p>
</li>
<li><p><strong>为什么Self-Attention可以替代RNN</strong></p>
<p><strong>无论是RNN还是CNN还是DNN，还是self-attention，本质都是特征提取器</strong></p>
<p>RNN在每个时刻存在一个隐藏状态，其中包含了当前和以前时刻输入的信息==&gt;其实就是特征提取，同CNN；</p>
<p><strong>Self-Attention是直接同时输出所有”隐藏状态”，其中包含通过每一个输出从整句话中获取到的注意力信息</strong>=&gt;也是特征提取</p>
<p>于是它们就都可以对隐藏层的输出输入进一个前馈神经网络，执行任务，或用提取得到的特征干其它事情</p>
</li>
</ol>
<h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><p><strong>$q,k,v$的含义以及为什么要这么运算</strong>：见上面的“<strong>Attention的本质</strong>“</p>
<ol>
<li><p>由每个输入获取$q、k、v$三个向量</p>
<p><strong>输入$x_i$是已经embedding的词向量</strong></p>
<p>$a_i=Wx_i$<strong>每一个输入$x_i$乘以三个不同的权值矩阵$W^q,W^k,W^v$（即线性变换），得到每个输入对应的</strong>$q_i、k_i、v_i$。query，key，value(information)。</p>
<p>此操作即<strong>对输入进行三个不同的embedding</strong>：$x_i$<strong>经过三个不同的线性层</strong>变成$q,k,v$，其实就<strong>相当于</strong>再经过了三个不同的词嵌入（embedding，权值矩阵$W^q,W^k,W^v$即不同的词嵌入矩阵）。结合上面的attention本质可以理解为什么要这样。</p>
<p><strong>这个权值矩阵的形状即为： 词表长度 x 目标向量q/k/v维度</strong>，得到一维向量$q,k,v$</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/8.png" alt="image-20200228205121484"></p>
</li>
<li><p>然后拿<strong>每一个</strong>$q$去与每一个输入对应的$k$做点积，得到每一个输入对应一个的$\alpha$</p>
<p><strong>这个$\alpha$就是attention权重</strong>，其实质上就是<strong>q和k的相似度</strong>（点积求相似度）</p>
<p><strong>这里先用第一个$q_1$</strong></p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/9.png" alt="image-20200228205627470"></p>
<p>$q·k$之后除以$\sqrt d$，为了防止太大</p>
</li>
<li><p>然后将self attention得到的$\alpha$经过softmax得到$\hat \alpha$</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/10.png" alt="image-20200228210057957"></p>
</li>
<li><p>然后再将softmax输出的$\hat \alpha$乘各自的$v$向量，并全部求和，得到第一个$q_1$的self-attention输出$b_1$，<strong>也就是第一个输入的self-attention输出结果</strong></p>
<p>下图softmax层没画出来</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/11.png" alt="image-20200228210221791"></p>
</li>
<li><p>同理，以上1234都是求第一个输入对应的$q_1$的self-attention输出结果$b_1$，求第二个输入对应的输出就用$q_2$重复上述流程</p>
<p>如下列举第二个$q_2$，softmax层没画出来</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/12.png" alt="image-20200228211904865"></p>
</li>
</ol>
<p><strong>可以看到，产生的每个输出，都用到了整个句子所有输入的信息。</strong>每个位置所乘的$W^q、W^k、W^v$就是模型要学习的东西。不同单词乘以这个权值参数生成不同的$q,k,v$，体现了”<strong>输入序列中不同单词的关注度不一样，具有注意力</strong>”   </p>
<p><strong>$q,k,v$的意义：$q$代表着这一整句话的embedding，$k=v$代表着每个单词的embedding</strong></p>
<p>此时输出的每一个位置的$b$就已经包含了从整句话（输入）中提取得到的注意力信息（特征信息）了</p>
<p>如果再多经过几层，那么提取得到的语义信息将会更抽象</p>
<h3 id="矩阵表达："><a href="#矩阵表达：" class="headerlink" title="矩阵表达："></a>矩阵表达：</h3><p>注意矩阵乘法的左行右列</p>
<ol>
<li><p>将上面图中每个位置对应的$q,k,v$组合起来成为矩阵以并行计算：</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/13.png" alt="image-20200228212453547"></p>
<p>于是根据上面的流程继续推：</p>
<p>只看$q_1$的1,2步过程（softmax之前，生成$q_1$与<strong>每一个位置</strong>上的$k_i$的<strong>每一个位置</strong>上的内积向量$\alpha_i$），可以如此组合</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/14.png" alt="image-20200228212629935"></p>
<p>若看<strong>所有输入位置</strong>的$q$：</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/15.png" alt="image-20200228213211597"></p>
<p>如此便生成了$\alpha$构成的<strong>Attention矩阵$A$，</strong>再经过softmax生成$\hat A$。</p>
</li>
<li><p>再看第4步乘$b$求和，矩阵表达</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/16.png" alt="image-20200228214136216"></p>
<p>$O$即最终输出的<strong>序列</strong></p>
<p>$Q、K、V$的维度都是$h_{hidden}×l_{src}$</p>
</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol>
<li><p>实际的矩阵乘法表示</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/19.png" alt="image-20200228214322939"></p>
<p>全是矩阵乘法，可以方便用GPU加速</p>
</li>
<li><p><strong>$q,k,v$这个过程的意义的补充</strong></p>
<p>主要部分都在Attention机制一节里，这里更具体化一下</p>
<p>通过$q$和$k$进行点积，并通过softmax得到每个词的一个attention权重（归一化，转化为概率），<strong>在句子内部做了一个attention，所以称作Self Attention</strong>。<strong>Self Attention可以刻画句子内部各成分之间的联系</strong>，比如说“看”跟“书”之间就建立了联系。这样，每个词的向量表示（$\hat \alpha$）就包含了句子里其他词的关联信息。</p>
</li>
</ol>
<h3 id="Multi-head-Self-attention"><a href="#Multi-head-Self-attention" class="headerlink" title="Multi-head Self-attention"></a>Multi-head Self-attention</h3><p>多个self-attention，对于一句话（一个输入序列）生成多个$Q、K、V$</p>
<p>得到多个$O$</p>
<p>这时候将多个$O$整合（可以求平均(多个head的期望），etc）</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/17.png" alt="image-20200228214704364"></p>
<p><strong>Multi-head Self-attention的意义</strong>：每个head（即一个完整的attention）的关注点不一样（即每个attention生成的$Q、K、V$不一样），于是多个attention组合起来就可以<strong>从“多个角度”去匹配输入句子中不同的模式</strong></p>
<p><strong>注意区别，单个attention与multi-head attention：</strong></p>
<p><strong>一个attention能够学习到输入序列的一种模式</strong>：即<strong>每个时刻的输出对输入（整句话）的“注意点”都不同</strong>，输入序列到<strong>每个输出时刻识别出一种模式，最终多个输出构成一个序列</strong></p>
<p><strong>多个attention就能够学习到输入序列的多种模式</strong>：<strong>每个输出时刻识别出多种模式，最终多个时刻的多个输出构成多个序列</strong></p>
<h3 id="Positional-Encoding"><a href="#Positional-Encoding" class="headerlink" title="Positional Encoding"></a>Positional Encoding</h3><p>在self-attention中<strong>没有编码输入单词的相对位置信息</strong>如句子$i_1,i_2,i_3,i_4$中，$i_1$与$i_2$相邻，$i_1$与$i_4$相隔很远，这种信息就没有编码进去。</p>
<p>具体实现有两种方式，一种是Facebook版本：《<a href="https://link.zhihu.com/?target=https%3A//arxiv.org/abs/1705.03122">Convolutional Sequence to Sequence Learning</a>》，另一种Google版本：Postional Encoding，两种效果没有差别。</p>
<hr>
<p>将<strong>输入[经过一个嵌入层]再[加上]一个位置向量$e^i$</strong>再乘以权值矩阵</p>
<p>这个<strong>位置向量是每个位置独有一个</strong>的，<strong>不是</strong>从数据中学习到的</p>
<p><strong>位置向量$e^i$生成：</strong>由编码位置信息的one-hot向量$p_i$乘上词嵌入矩阵$W^P$得到的。这个<strong>$W^P$是人为设定的，就是原论文中sin，cos公式所表达的矩阵：</strong></p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/Users\htt20\Desktop\NLP-Transformer.png" alt="NLP-Transformer"></p>
<p>当然这个$W^p$也可以直接随机初始化让模型来学习</p>
<p>为什么要用这个公式的一种理解是：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/347678607/answer/835053468">如何理解Transformer论文中的positional encoding，和三角函数有什么关系？ - 徐啸的回答 - 知乎</a> （mark）</p>
<h3 id="【O】Seq2seq-with-Self-Attention"><a href="#【O】Seq2seq-with-Self-Attention" class="headerlink" title="【O】Seq2seq with Self-Attention"></a>【O】Seq2seq with Self-Attention</h3><p>将Seq2Seq模型中Encoder和Decoder全用self-attention代替</p>
<p>注意力允许解码器网络针对解码器自身输出的每一步“聚焦”编码器输出的不同部分。</p>
<p><img src="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/Attention/18.png" alt="image-20200301182413221"></p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>Pytorch.nn中已经实现Multi-head Attention</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>MultiheadAttention<span class="token punctuation">(</span>embed_dim<span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span> dropout<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> add_bias_kv<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> add_zero_attn<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> kdim<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> vdim<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>attention的实现实际上就是从原理上来实现，本质就是在线性层（参数就是个矩阵）基础上多了一些（一堆）变换，训练attention就是训练该线性变换层的参数矩阵</p>
<p>而self-attention由于有三个参数矩阵，输入经过了三个不同的线性层，要训练的就是这三个线性层的参数矩阵</p>
<p>具体实现见源代码</p>
<hr>
<p><strong>Attention机制+Encoder Decoder结构</strong>不仅在NLP（在NLP已成标配），在很多领域都有大量应用，如图像描述等</p>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="/images/donate/AliPayQR.jpg"></li>
                <li class="wechat-code"><img src="/images/donate/WeChanQR.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0%EF%BC%8CMLE%EF%BC%8CMAP%EF%BC%8CERM%E7%9A%84%E5%85%B3%E7%B3%BB/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                损失函数，MLE，MAP，ERM的关系</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/%E7%A8%8B%E5%BA%8F%E8%AF%AD%E8%A8%80/JAVA%E5%AE%B9%E5%99%A8/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                JAVA容器</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "d2ULHdiL7VOfJf17rpCD4DOX-gzGzoHsz",
        appKey: "OLf7QaP1oTtqKhulLHuajYKu",
        path: window.location.pathname,

        emojiCDN: 'https://valinecdn.bili33.top/',
        emojiMaps: {
          //bilibili2233/
          "2233娘_卖萌":"bilibili2233/[2233娘_卖萌].png","2233娘_吃惊":"bilibili2233/[2233娘_吃惊].png",
          "2233娘_吐魂":"bilibili2233/[2233娘_吐魂].png","2233娘_喝水":"bilibili2233/[2233娘_喝水].png",
          "2233娘_困惑":"bilibili2233/[2233娘_困惑].png","2233娘_大哭":"bilibili2233/[2233娘_大哭].png",
          "2233娘_大笑":"bilibili2233/[2233娘_大笑].png","2233娘_委屈":"bilibili2233/[2233娘_委屈].png",
          "2233娘_怒":"bilibili2233/[2233娘_怒].png","2233娘_无言":"bilibili2233/[2233娘_无言].png",
          "2233娘_汗":"bilibili2233/[2233娘_汗].png","2233娘_疑问":"bilibili2233/[2233娘_疑问].png",
          "2233娘_第一":"bilibili2233/[2233娘_第一].png","2233娘_耶":"bilibili2233/[2233娘_耶].png",
          "2233娘_郁闷":"bilibili2233/[2233娘_郁闷].png",
          //Tieba/
          "0":"Tieba/i_f01.png","11":"Tieba/i_f02.png","22":"Tieba/i_f03.png",
          "1":"Tieba/i_f04.png","12":"Tieba/i_f05.png","23":"Tieba/i_f06.png",
          "2":"Tieba/i_f07.png","13":"Tieba/i_f08.png","24":"Tieba/i_f09.png",
          "3":"Tieba/i_f10.png","14":"Tieba/i_f11.png","25":"Tieba/i_f12.png",
          "4":"Tieba/i_f13.png","15":"Tieba/i_f14.png","26":"Tieba/i_f15.png",
          "5":"Tieba/i_f16.png","16":"Tieba/i_f17.png","27":"Tieba/i_f18.png",
          "6":"Tieba/i_f19.png","17":"Tieba/i_f20.png","28":"Tieba/i_f21.png",
          "7":"Tieba/i_f22.png","18":"Tieba/i_f23.png","29":"Tieba/i_f24.png",
          "8":"Tieba/i_f25.png","19":"Tieba/i_f26.png","30":"Tieba/i_f27.png",
          "9":"Tieba/i_f28.png","20":"Tieba/i_f29.png","31":"Tieba/i_f30.png",
          "10":"Tieba/i_f31.png","21":"Tieba/i_f32.png","32":"Tieba/i_f33.png",
          //weibo/
          "33":"weibo/d_chigua.png","34":"weibo/d_chijing.png","35":"weibo/d_doge.png",
          "36":"weibo/d_erha.png","37":"weibo/d_kelian.png","38":"weibo/h_quantou.png",
          "39":"weibo/h_zuoyi.png","40":"weibo/h_zan.png","41":"weibo/d_xiaoku.png",
          "43":"weibo/d_xixi.png",
          //bilibiliHotKey/
          "44":"bilibiliHotKey/1.jpg","52":"bilibiliHotKey/10.jpg","60":"bilibiliHotKey/11.jpg","68":"bilibiliHotKey/12.jpg",
          "45":"bilibiliHotKey/13.jpg","53":"bilibiliHotKey/14.jpg","61":"bilibiliHotKey/15.jpg","69":"bilibiliHotKey/16.jpg",
          "46":"bilibiliHotKey/17.jpg","54":"bilibiliHotKey/18.jpg","62":"bilibiliHotKey/19.jpg","70":"bilibiliHotKey/2.jpg",
          "47":"bilibiliHotKey/20.jpg","55":"bilibiliHotKey/21.jpg","63":"bilibiliHotKey/22.jpg","71":"bilibiliHotKey/23.jpg",
          "48":"bilibiliHotKey/24.jpg","56":"bilibiliHotKey/25.jpg","64":"bilibiliHotKey/26.jpg","72":"bilibiliHotKey/27.jpg",
          "49":"bilibiliHotKey/28.jpg","57":"bilibiliHotKey/29.jpg","65":"bilibiliHotKey/3.jpg","73":"bilibiliHotKey/30.jpg",
          "50":"bilibiliHotKey/31.jpg","58":"bilibiliHotKey/32.jpg","66":"bilibiliHotKey/4.jpg","74":"bilibiliHotKey/5.jpg",
          "51":"bilibiliHotKey/6.jpg","59":"bilibiliHotKey/7.jpg","67":"bilibiliHotKey/8.jpg","75":"bilibiliHotKey/9.jpg",
          //Majotabi/
          "77":"Majotabi/367516718.png","91":"Majotabi/367516719.png","104":"Majotabi/367516720.png",
          "78":"Majotabi/367516721.png","92":"Majotabi/367516722.png","105":"Majotabi/367516723.png",
          "79":"Majotabi/367516724.png","93":"Majotabi/367516725.png","106":"Majotabi/367516726.png",
          "80":"Majotabi/367516727.png","94":"Majotabi/367516728.png","107":"Majotabi/367516729.png",
          "81":"Majotabi/367516730.png","95":"Majotabi/367516731.png","108":"Majotabi/367516732.png",
          "82":"Majotabi/367516733.png","96":"Majotabi/367516734.png","109":"Majotabi/367516735.png",
          "83":"Majotabi/367516736.png","97":"Majotabi/367516737.png","110":"Majotabi/367516738.png",
          "84":"Majotabi/367516739.png","98":"Majotabi/367516740.png","111":"Majotabi/367516741.png",
          "85":"Majotabi/367516742.png","99":"Majotabi/367516743.png","112":"Majotabi/367516744.png",
          "86":"Majotabi/367516745.png","100":"Majotabi/367516746.png","113":"Majotabi/367516747.png",
          "87":"Majotabi/367516748.png","101":"Majotabi/367516749.png","114":"Majotabi/367516750.png",
          "88":"Majotabi/367516751.png","102":"Majotabi/367516752.png","115":"Majotabi/367516753.png",
          "89":"Majotabi/367516754.png","103":"Majotabi/367516755.png","116":"Majotabi/367516756.png",
          "90":"Majotabi/367516757.png",

        },
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>


      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="/about/" class="profile gravatar">

            <img src="/images/img/112.jpg" itemprop="image" alt="" height="70" width="70">
          </a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">

            <a href="https://aisaka.cloud" itemprop="url" rel="author"></a>
            </h3>
          </div>
        </div>
        <hr>

        <p><i class="iconfont icon-write"></i>且听风吟</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>


  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
  </script>


    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            // PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 aisaka<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2016~2021</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">
          aisaka
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<!-- <script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script> -->
<script src='//unpkg.com/valine@1.4.14/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "","name":"","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "","name":"","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="/images/img/112.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">宵晓咲</p>
  <p style="text-align: center; word-spacing: 20px;">
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  " aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            时间线
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            ACG
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/Anime/">
                  <i class="fa " aria-hidden="true"></i>
                  动画
                </a>
              </li>
            
              <li>
                <a href="/categories/Game/">
                  <i class="fa " aria-hidden="true"></i>
                  游戏
                </a>
              </li>
            
              <li>
                <a href="/categories/Music/">
                  <i class="fa " aria-hidden="true"></i>
                  音乐
                </a>
              </li>
            
              <li>
                <a href="/categories/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1/">
                  <i class="fa " aria-hidden="true"></i>
                  游戏设计
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-book faa-shake" aria-hidden="true"></i>
            随想
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/%E6%97%A5%E8%AE%B0/">
                  <i class="fa " aria-hidden="true"></i>
                  日记
                </a>
              </li>
            
              <li>
                <a href="/categories/%E9%98%85%E8%AF%BB/">
                  <i class="fa " aria-hidden="true"></i>
                  阅读
                </a>
              </li>
            
              <li>
                <a href="/categories/%E9%9A%8F%E7%AC%94/">
                  <i class="fa " aria-hidden="true"></i>
                  随笔
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-code faa-shake" aria-hidden="true"></i>
            技术
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/%E7%A8%8B%E5%BA%8F%E8%AF%AD%E8%A8%80/">
                  <i class="fa " aria-hidden="true"></i>
                  程序
                </a>
              </li>
            
              <li>
                <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                  <i class="fa " aria-hidden="true"></i>
                  人工智能
                </a>
              </li>
            
              <li>
                <a href="/categories/%E5%BC%80%E5%8F%91/">
                  <i class="fa " aria-hidden="true"></i>
                  开发
                </a>
              </li>
            
              <li>
                <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E4%B8%AD%E9%97%B4%E4%BB%B6/">
                  <i class="fa " aria-hidden="true"></i>
                  中间件
                </a>
              </li>
            
              <li>
                <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E4%BA%91/">
                  <i class="fa " aria-hidden="true"></i>
                  网络
                </a>
              </li>
            
              <li>
                <a href="/categories/%E5%AD%98%E5%82%A8/">
                  <i class="fa " aria-hidden="true"></i>
                  存储
                </a>
              </li>
            
              <li>
                <a href="/categories/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
                  <i class="fa " aria-hidden="true"></i>
                  算法
                </a>
              </li>
            
              <li>
                <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/">
                  <i class="fa " aria-hidden="true"></i>
                  CS
                </a>
              </li>
            
              <li>
                <a href="/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">
                  <i class="fa " aria-hidden="true"></i>
                  论文
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            其它
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/%E7%A1%AC%E4%BB%B6/">
                  <i class="fa " aria-hidden="true"></i>
                  硬件
                </a>
              </li>
            
              <li>
                <a href="/categories/%E5%8D%9A%E5%AE%A2/">
                  <i class="fa " aria-hidden="true"></i>
                  博客
                </a>
              </li>
            
              <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7/">
                  <i class="fa " aria-hidden="true"></i>
                  工具
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/%E6%82%A6%E8%AF%BB/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  书单
                </a>
              </li>
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  番组
                </a>
              </li>
            
              <li>
                <a href="/musicLibrary/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
              <li>
                <a href="/tags/%E5%9B%BE%E9%9B%86/">
                  <i class="fa fa-photo" aria-hidden="true"></i>
                  图集
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            Link
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/about/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-meetup faa-shake" aria-hidden="true"></i>
            我
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id=""

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<!--这里我want aplayer失效-->
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>

</body>
</html>